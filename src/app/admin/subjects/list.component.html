
<!-- Admin Subjects Management -->
<div class="container-fluid p-0" style="background-color: #f8f9fa; min-height: 100vh;">
  <div class="row g-0">
    <!-- Content Area -->
    <div class="col" style="padding: 40px 60px;">
      <!-- Header Section -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0" style="color: #333; font-weight: 600; font-size: 2rem;">Subjects Management</h2>
        <div class="d-flex gap-4">
          <div class="text-end">
            <span style="color: #666; font-size: 0.95rem;">Grade 11 & 12 Subjects</span>
          </div>
          <div class="text-end">
            <button class="btn" style="background-color: #1e3a8a; color: white; border-color: #1e3a8a; border-radius: 5px;" (click)="openAddModal()">
              Add New Subject
            </button>
          </div>
        </div>
      </div>

      <!-- Filters Section -->
      <div style="border: 3px solid #000; background: white; padding: 30px 25px; margin: 20px 0; position: relative;">
        <!-- Filters label in top left -->
        <div style="position: absolute; top: -15px; left: 15px; background: #f8f9fa; padding: 0 15px;">
          <span style="color: #000; font-weight: 600; font-size: 1.1rem;">Filter Subjects</span>
        </div>
      <div class="row">
        <div class="col-md-2 mb-3">
          <label class="form-label">Grade Level</label>
          <select class="form-select" [(ngModel)]="filterGradeLevel" (change)="applyFilters()">
            <option value="">All Grades</option>
            <option value="11">Grade 11</option>
            <option value="12">Grade 12</option>
          </select>
        </div>
        <div class="col-md-2 mb-3">
          <label class="form-label">Strand</label>
          <select class="form-select" [(ngModel)]="filterStrand" (change)="applyFilters()">
            <option value="">All Strands</option>
            <option value="ABM">ABM</option>
            <option value="HUMSS">HUMSS</option>
            <option value="STEM">STEM</option>
            <option value="GAS">GAS</option>
            <option value="TVL">TVL</option>
            <option value="ICT">ICT</option>
          </select>
        </div>
        <div class="col-md-2 mb-3">
          <label class="form-label">Semester</label>
          <select class="form-select" [(ngModel)]="filterSemester" (change)="applyFilters()">
            <option value="">All Semesters</option>
            <option value="1st">1st Semester</option>
            <option value="2nd">2nd Semester</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">Search</label>
          <div class="input-group">
            <span class="input-group-text">üîç</span>
            <input type="text" class="form-control" placeholder="Search subjects..."
                   [(ngModel)]="searchTerm" (input)="applyFilters()">
          </div>
        </div>
        </div>
      </div>

      <!-- Results Summary -->
      <div class="alert alert-info mb-4" *ngIf="filterGradeLevel || filterStrand || filterSemester">
        <strong>Showing {{ groupedSubjects.length }} unique subjects</strong>
        <span *ngIf="filterGradeLevel"> for Grade {{ filterGradeLevel }}</span>
        <span *ngIf="filterStrand"> in {{ filterStrand }}</span>
        <span *ngIf="filterSemester"> for {{ filterSemester }} Semester</span>
      </div>

      <!-- Subjects Table Section -->
      <div style="border: 3px solid #000; background: white; padding: 30px 25px; margin: 20px 0; position: relative;">
        <!-- Subjects Table label in top left -->
        <div style="position: absolute; top: -15px; left: 15px; background: #f8f9fa; padding: 0 15px;">
          <span style="color: #000; font-weight: 600; font-size: 1.1rem;">Subjects List</span>
        </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead style="background-color: #1e3a8a; color: white;">
            <tr>
              <th style="width: 5%">#</th>
              <th style="width: 35%">SUBJECT NAME</th>
              <th style="width: 10%">GRADE</th>
              <th style="width: 25%">STRANDS</th>
              <th style="width: 15%">SCHOOL YEAR</th>
              <th style="width: 10%">SEMESTER</th>
              <th class="text-center" style="width: 10%">ACTIONS</th>
            </tr>
          </thead>
            <tbody>
              <tr *ngFor="let subject of groupedSubjects; let i = index" class="align-middle">
                <td class="fw-bold py-3">{{ subject.displayId }}</td>
                <td class="py-3">
                  <div class="fw-semibold">{{ subject.subjectName }}</div>
                </td>
                <td class="py-3">
                  <span class="fw-bold" style="color: #1e3a8a;">{{ subject.grade_level }}</span>
                </td>
                <td class="py-3">
                  <div class="d-flex flex-wrap gap-2">
                    <span *ngFor="let strand of subject.strands"
                          class="fw-semibold" [style.color]="getStrandColor(strand)">{{ strand }}</span>
                  </div>
                </td>
                <td class="py-3">{{ subject.school_year }}</td>
                <td class="py-3">
                  <span class="fw-bold" style="color: #b45309;">{{ subject.semester }}</span>
                </td>
                <td class="py-3 text-center">
                  <div class="btn-group" role="group">
                    <button class="btn btn-sm" style="background-color: #1e3a8a; color: white; border-color: #1e3a8a;" (click)="editGroupedSubject(subject)">
                      Edit
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="deleteGroupedSubject(subject)">
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
        </table>
      </div>

        <div *ngIf="groupedSubjects.length === 0" class="text-center py-5">
          <h4 class="fw-bold text-dark mb-3">No subjects found</h4>
          <p class="text-muted mb-4">Try adjusting your filters or add a new subject.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Subject Modal -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'"
     tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div class="text-center w-100">
          <h4 class="mb-0 fw-bold">
            {{ isEditMode ? 'Edit Subject' : 'Add New Subject' }}
          </h4>
          <p class="mb-0 text-muted">
            {{ isEditMode ? 'Update subject information' : 'Create a new subject for the curriculum' }}
          </p>
        </div>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <form [formGroup]="subjectForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">Grade Level <span class="text-danger">*</span></label>
              <select class="form-select" formControlName="grade_level" (change)="onGradeChange()">
                <option value="">Select Grade Level</option>
                <option value="11">Grade 11</option>
                <option value="12">Grade 12</option>
              </select>
              <div *ngIf="submitted && f.grade_level.errors" class="invalid-feedback d-block">
                Grade level is required
              </div>
            </div>
            
            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">Strand <span class="text-danger">*</span></label>
              <select class="form-select" formControlName="strand" (change)="onStrandChange()">
                <option value="">Select Strand</option>
                <option value="ABM">Accountancy, Business and Management (ABM)</option>
                <option value="HUMSS">Humanities and Social Sciences (HUMSS)</option>
                <option value="STEM">Science, Technology, Engineering and Mathematics (STEM)</option>
                <option value="GAS">General Academic Strand (GAS)</option>
                <option value="TVL">Technical-Vocational-Livelihood (TVL)</option>
                <option value = "ICT">Information and Computer Technology (ICT)</option>
              </select>
              <div *ngIf="submitted && f.strand.errors" class="invalid-feedback d-block">
                Strand is required
              </div>
            </div>

            <div class="col-md-12 mb-4">
              <label class="form-label fw-semibold">Subject Name <span class="text-danger">*</span></label>
              <select class="form-select" formControlName="subjectName">
                <option value="">Select Subject</option>
                <option *ngFor="let subject of availableSubjects" [value]="subject">{{ subject }}</option>
              </select>
              <div *ngIf="submitted && f.subjectName.errors" class="invalid-feedback d-block">
                Subject name is required
              </div>
            </div>
            
            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">Section <span class="text-danger">*</span></label>
              <input type="text" class="form-control" formControlName="section"
                     placeholder="e.g., A, B, C">
              <div *ngIf="submitted && f.section.errors" class="invalid-feedback d-block">
                Section is required
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">School Year <span class="text-danger">*</span></label>
              <input type="text" class="form-control" formControlName="school_year"
                     placeholder="e.g., 2023-2024">
              <div *ngIf="submitted && f.school_year.errors" class="invalid-feedback d-block">
                School year is required
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">Semester <span class="text-danger">*</span></label>
              <select class="form-select" formControlName="semester">
                <option value="">Select Semester</option>
                <option value="1st">1st Semester</option>
                <option value="2nd">2nd Semester</option>
              </select>
              <div *ngIf="submitted && f.semester.errors" class="invalid-feedback d-block">
                Semester is required
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            {{ isEditMode ? 'Update Subject' : 'Add Subject' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal"></div>


