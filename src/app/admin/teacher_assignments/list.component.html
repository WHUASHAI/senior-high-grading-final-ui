<!-- Admin Teacher Assignments -->
<div class="container-fluid p-0" style="background-color: #f8f9fa; min-height: 100vh;">
  <div class="row g-0">
    <!-- Content Area -->
    <div class="col" style="padding: 40px 60px;">
      <!-- Header Section -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0" style="color: #333; font-weight: 600; font-size: 2rem;">Teacher Assignments</h2>
        <div class="d-flex gap-4">
          <div class="text-end">
            <span style="color: #666; font-size: 0.95rem;">Subject Assignments</span>
          </div>
          <div class="text-end" *ngIf="teachers.length > 0">
            <button class="btn" style="background-color: #1e3a8a; color: white; border-color: #1e3a8a; border-radius: 5px;" (click)="openAddModal()">
              Assign Teacher
            </button>
          </div>
        </div>
      </div>

      <!-- No Teachers Warning -->
      <div class="alert alert-warning mb-4" *ngIf="teachers.length === 0">
        <strong>No teachers available!</strong>
        Please register teachers first in the <a routerLink="/admin/accounts" class="text-decoration-none fw-bold">Accounts section</a> before creating assignments.
      </div>

      <!-- Teacher Assignments Table Section -->
      <div style="border: 3px solid #000; background: white; padding: 30px 25px; margin: 20px 0; position: relative;">
        <!-- Teacher Assignments label in top left -->
        <div style="position: absolute; top: -15px; left: 15px; background: #f8f9fa; padding: 0 15px;">
          <span style="color: #000; font-weight: 600; font-size: 1.1rem;">Teacher Assignments</span>
        </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead style="background-color: #1e3a8a; color: white;">
            <tr>
              <th style="width: 5%">#</th>
              <th style="width: 20%">TEACHER</th>
              <th style="width: 25%">SUBJECT</th>
              <th style="width: 10%">GRADE</th>
              <th style="width: 12%">STRAND</th>
              <th style="width: 13%">SEMESTER</th>
              <th class="text-center" style="width: 15%">ACTIONS</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let assignment of teacherAssignments; let i = index" class="align-middle">
              <td class="fw-bold py-3">{{ assignment.id }}</td>
              <td class="py-3">
                <div class="d-flex align-items-center">
                  <div class="teacher-avatar me-3">
                    {{ assignment.teacherName?.split(' ')[0]?.charAt(0) }}{{ assignment.teacherName?.split(' ')[1]?.charAt(0) }}
                  </div>
                  <div class="fw-semibold">{{ assignment.teacherName }}</div>
                </div>
              </td>
              <td class="py-3">{{ assignment.subjectName }}</td>
              <td class="py-3">
                <span class="fw-bold" style="color: #1e3a8a;">{{ assignment.grade_level }}</span>
              </td>
              <td class="py-3">
                <span class="fw-semibold" [style.color]="getStrandColor(assignment.strand)">{{ assignment.strand }}</span>
              </td>
              <td class="py-3">
                <span class="fw-bold" style="color: #b45309;">{{ assignment.semester }}</span>
              </td>
              <td class="py-3 text-center">
                <div class="btn-group" role="group">
                  <button class="btn btn-sm" style="background-color: #1e3a8a; color: white; border-color: #1e3a8a;" (click)="editAssignment(assignment)">
                    Edit
                  </button>
                  <button class="btn btn-danger btn-sm" (click)="deleteAssignment(assignment.id)">
                    Delete
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

        <div *ngIf="teacherAssignments.length === 0" class="text-center py-5">
          <h4 class="fw-bold text-dark mb-3">No teacher assignments found</h4>
          <p class="text-muted mb-4">Start by assigning teachers to subjects.</p>
          <div *ngIf="teachers.length === 0" class="alert alert-warning mt-3">
            No teachers available. Please register teachers first in the <strong>Accounts</strong> section.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Assignment Modal -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'"
     tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <div class="text-center w-100">
          <h4 class="mb-0 fw-bold">
            {{ isEditMode ? 'Edit Assignment' : 'Assign Teacher' }}
          </h4>
          <p class="mb-0 text-muted">
            {{ isEditMode ? 'Update teacher assignment' : 'Assign a teacher to a subject' }}
          </p>
        </div>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <form [formGroup]="assignmentForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="mb-4">
            <label class="form-label fw-semibold">Teacher <span class="text-danger">*</span></label>
            <select class="form-select" formControlName="teacherId">
              <option value="">Select Teacher</option>
              <option *ngFor="let teacher of teachers" [value]="teacher.id">
                {{ teacher.firstName }} {{ teacher.lastName }}
              </option>
            </select>
            <div *ngIf="submitted && f.teacherId.errors" class="invalid-feedback d-block">
              Teacher is required
            </div>
            <div *ngIf="teachers.length === 0" class="text-warning mt-2">
              No teachers available. Please create teacher accounts first.
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label fw-semibold">Subject <span class="text-danger">*</span></label>
            <select class="form-select" formControlName="subjectId">
              <option value="">Select Subject</option>
              <option *ngFor="let subject of subjects" [value]="subject.id">
                {{ subject.subjectName }} (Grade {{ subject.grade_level }} - {{ subject.strand }} - {{ subject.semester }} Sem)
              </option>
            </select>
            <div *ngIf="submitted && f.subjectId.errors" class="invalid-feedback d-block">
              Subject is required
            </div>
            <div *ngIf="subjects.length === 0" class="text-warning mt-2">
              No subjects available. Subjects are being generated...
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            {{ isEditMode ? 'Update Assignment' : 'Assign Teacher' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal"></div>


